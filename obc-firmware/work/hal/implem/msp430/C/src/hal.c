/* Body file for function HAL
 * Generated by TASTE on 2023-03-10 23:20:06
 * You can edit this file, it will not be overwritten
 * Provided interfaces : get_temperature, led_blink
 * Required interfaces : 
 * User-defined properties for this function:
 *   |_ Taste::Startup_Priority = 1
 * Timers              : 
 */

#include "hal.h"

#include <msp430.h>
#include <FreeRTOS.h>
#include <semphr.h>

#include "msp430_pwm.h"

void hal_startup( void )
{
   // Write your initialisation code, but DO NOT CALL REQUIRED INTERFACES
    WDTCTL = WDTPW | WDTHOLD;           // stop watchdog timer
    PM5CTL0 &= ~LOCKLPM5;               // disable the GPIO power-on default high-impedance mode
                                        // to activate previously configured port settings

    P1DIR |= 0x01;                      // Set P1.0 to output direction
    P4DIR |= 0x40;                      // Set P4.6 to output direction
    P4OUT &= ~0x40;                     // Unset P4.6

    setup_pwm(2400);                    // set up PWM with a ~400ms period
}

void hal_PI_blink_led(void)
{
    P1OUT ^= 0x01;                      // Toggle P1.0 using XOR
}

void hal_PI_set_led( const asn1SccT_Boolean *IN_val )
{
    if (*IN_val)
    {
        P4OUT |= 0x40;                  // Set P4.6 using OR
    }
    else
    {
        P4OUT &= ~0x40;                 // Unset P4.6 using AND
    }
}

void hal_PI_send_camera_capture_image_pulse( void )
{
    pulse_single_width(2000);               // 2.0ms pulse (periodic, needs pulse)
}

void hal_PI_send_camera_toggle_usb_pulse( void )
{
    pulse_single_width(1500);               // 1.5ms pulse (periodic, needs pulse)
}

void hal_PI_send_camera_idle_signal( void )
{
    //set_pwm_pulse_width(1000);               // 1.0ms pulses (periodic)
}
