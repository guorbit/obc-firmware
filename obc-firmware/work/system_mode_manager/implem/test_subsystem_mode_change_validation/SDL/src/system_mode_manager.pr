/* CIF PROCESS (312, 148), (164, 75) */
process System_Mode_Manager;
    /* CIF Keep Specific Geode Partition 'default' */
    /* CIF TEXT (196, 56), (416, 173) */
    -- Text area for declarations and comments
    
    dcl current_system_mode System_Mode_T;
    dcl target_system_mode System_Mode_T;
    
    dcl system_mode_idle System_Mode_T;
    
    dcl system_mode_status_report System_Mode_Status_Report_T;
    
    dcl payload_mode_status_report Payload_Mode_Status_Report_T;
    dcl pipeline_mode_status_report Pipeline_Mode_Status_Report_T;
    /* CIF ENDTEXT */
    /* CIF procedure (318, 607), (153, 35) */
    /* CIF Keep Specific Geode Partition 'default' */
    procedure change_system_mode;
        /* CIF Keep Specific Geode Partition 'default' */
        /* CIF TEXT (23, 29), (296, 140) */
        -- Text area for declarations and comments
        
        -- exported procedure
        fpar
            in Target_System_Mode_In System_Mode_T;
        /* CIF ENDTEXT */
        /* CIF START (458, 58), (70, 35) */
        START;
            /* CIF task (339, 113), (306, 35) */
            task target_system_mode := target_system_mode_in;
            /* CIF return (475, 168), (35, 35) */
            return ;
    endprocedure;
    /* CIF START (361, 314), (70, 35) */
    START;
        /* CIF task (297, 369), (196, 68) */
        task current_system_mode := {
  payload_mode payload_idle,
  pipeline_mode pipeline_idle
};
        /* CIF NEXTSTATE (346, 467), (98, 35) */
        NEXTSTATE Wait_change;
    /* CIF label (2928, 356), (100, 35) */
    /* CIF Keep Specific Geode Partition 'default' */
    connection pipeline_skip:
        /* CIF task (2670, 411), (616, 35) */
        task system_mode_status_report.pipeline_report.pipeline_mode := current_system_mode.pipeline_mode;
        /* CIF task (2724, 466), (508, 35) */
        task system_mode_status_report.pipeline_report.pipeline_last_op := mode_status_nop;
        /* CIF join (2961, 521), (35, 35) */
        join pipeline_done;
    /* CIF End Label */
    endconnection;
    /* CIF label (1634, 352), (99, 35) */
    /* CIF Keep Specific Geode Partition 'default' */
    connection payload_skip:
        /* CIF task (1377, 407), (613, 35) */
        task system_mode_status_report.payload_report.payload_mode := current_system_mode.payload_mode;
        /* CIF task (1430, 462), (506, 35) */
        task system_mode_status_report.payload_report.payload_last_op := mode_status_nop;
        /* CIF join (1666, 517), (35, 35) */
        join payload_done;
    /* CIF End Label */
    endconnection;
    /* CIF label (2324, 81), (105, 35) */
    /* CIF Keep Specific Geode Partition 'default' */
    connection payload_done:
        /* CIF output (2185, 136), (383, 35) */
        output change_pipeline_mode(target_system_mode.pipeline_mode);
        /* CIF NEXTSTATE (2325, 191), (103, 35) */
        NEXTSTATE Wait_Pipeline;
    /* CIF End Label */
    endconnection;
    /* CIF label (340, 741), (106, 35) */
    /* CIF Keep Specific Geode Partition 'default' */
    connection pipeline_done:
        /* CIF output (192, 796), (403, 35) */
        output relay_system_mode_status_report(system_mode_status_report);
        /* CIF NEXTSTATE (344, 846), (98, 35) */
        NEXTSTATE Wait_change;
    /* CIF End Label */
    endconnection;
    /* CIF state (1025, 349), (102, 35) */
    /* CIF Keep Specific Geode Partition 'default' */
    state Wait_Payload;
        /* CIF input (887, 404), (378, 35) */
        input report_payload_mode_status(payload_mode_status_report);
            /* CIF decision (933, 459), (286, 50) */
            decision payload_mode_status_report.payload_mode;
                /* CIF ANSWER (781, 529), (237, 23) */
                (target_system_mode.payload_mode):
                    /* CIF task (662, 567), (475, 35) */
                    task current_system_mode.payload_mode := target_system_mode.payload_mode;
                /* CIF ANSWER (1215, 529), (70, 23) */
                else:
            enddecision;
            /* CIF task (838, 618), (475, 35) */
            task system_mode_status_report.payload_report := payload_mode_status_report;
            /* CIF join (1058, 668), (35, 35) */
            join payload_done;
    endstate;
    /* CIF state (2330, 355), (103, 35) */
    /* CIF Keep Specific Geode Partition 'default' */
    state Wait_Pipeline;
        /* CIF input (2191, 410), (380, 35) */
        input report_pipeline_mode_status(pipeline_mode_status_report);
            /* CIF decision (2237, 465), (288, 50) */
            decision pipeline_mode_status_report.pipeline_mode;
                /* CIF ANSWER (2120, 535), (238, 23) */
                (target_system_mode.pipeline_mode):
                    /* CIF task (2001, 573), (477, 35) */
                    task current_system_mode.pipeline_mode := target_system_mode.pipeline_mode;
                /* CIF ANSWER (2525, 535), (70, 23) */
                else:
            enddecision;
            /* CIF task (2143, 624), (477, 35) */
            task system_mode_status_report.pipeline_report := pipeline_mode_status_report;
            /* CIF join (2364, 679), (35, 35) */
            join pipeline_done;
    endstate;
    /* CIF state (1031, 61), (98, 35) */
    /* CIF Keep Specific Geode Partition 'default' */
    state Wait_change;
        /* CIF input (1004, 116), (153, 35) */
        input change_system_mode;
            /* CIF output (890, 171), (381, 35) */
            output change_payload_mode(target_system_mode.payload_mode);
            /* CIF NEXTSTATE (1030, 226), (102, 35) */
            NEXTSTATE Wait_Payload;
    endstate;
endprocess System_Mode_Manager;